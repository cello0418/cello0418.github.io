<!DOCTYPE html>
<html data-scheme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>數位驗證</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocas-ui/4.0.2/tocas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocas-ui/4.0.2/tocas.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>

        .center{
            padding: 10%;
            min-width:1180px; 
            height:  600%
        }
        
        .verify_style{
            font-size: xx-large;
            color: lightcoral;

        }
        .fa-check{
            color: blue;
        }
        #licence{
            width: 100%;
            height: 600px;
            background-size: contain;
            background-image: url('licence.jpg');
            background-repeat: no-repeat;
            position:absolute;
        }
        #name{
            z-index: 4;
            padding-top: 30%;
            padding-right: 20%;
        }
        #under_data{
            padding-top: 7%;
            padding-left: 16%;
            display:inline-block;
        }
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
    <script type="text/javascript">
        function close_window(){
            $("#verify_window, #data_windows").removeClass("is-visible");
        }

        function queryString()
            {
                // This function is anonymous, is executed immediately and
                // the return value is assigned to QueryString!
                var query_string = {};
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i = 0; i < vars.length; i++)
                {
                    var pair = vars[i].split("=");
                    if(pair.length <= 1 ){
                        return undefined;        
                    }
                    // If first entry with this name
                    if (typeof query_string[pair[0]] === "undefined")
                    {
                        query_string[pair[0]] = pair[1];
                        // If second entry with this name
                    } else if (typeof query_string[pair[0]] === "string")
                    {
                        var arr = [query_string[pair[0]], pair[1]];
                        query_string[pair[0]] = arr;
                        // If third or later entry with this name
                    } else
                    {
                        query_string[pair[0]].push(pair[1]);
                    }
                }
                return query_string;
            }
        var data_windows_is_open = false;    
        function windows_function(){
            if(data_windows_is_open === false){
                $("#data_windows").addClass("is-visible");
                data_windows_is_open = true;
            }else{
                $("#data_windows").removeClass("is-visible");
                data_windows_is_open = false;
            }
        }    
        $( document ).ready(function() {
            if(queryString() != undefined){
                var hashcode = queryString()['hashcode'];
                if(hashcode != undefined){
                    fetch('./key.json')
                        .then( res => {
                            return res.json();
                        })
                        .then( res => {
                            if( res[hashcode] != undefined ){
                                
                                setTimeout(  function(){ $("#block_start").hide() }, 3000 );
                                setTimeout(  function(){ $("#block_start_i").show() }, 3000 );
                                
                                setTimeout(  function(){ $("#second_ul").show() }, 3300 );
                                setTimeout(  function(){ $("#block_mid").hide() }, 5000 );
                                setTimeout(  function(){ $("#block_mid_i").show() }, 5000 );

                                setTimeout(  function(){ $("#third_ul").show() }, 5000 );
                                setTimeout(  function(){ $("#block_end").hide() }, 7000 );
                                setTimeout(  function(){ $("#block_end_i").show() }, 7000 );

                                $("#block").html(hashcode);
                                setTimeout(  function(){ $("#start").html("皮膚科學會會員")}, 7100 );
                                setTimeout(  function(){ $("#name").html(res[hashcode])}, 7100 );
                                setTimeout(  function(){ $("#end").html("已驗證")}, 7100 );

                                new QRCode(document.getElementById("qrcode"),
                                    {
                                        text: `https://explore.ipld.io/#/explore/${hashcode}`,
                                        width: 60,
                                        height: 60
                                    }
                                );
                            }else{
                                setInterval(  function(){ $("#content").html("<ul>連接區塊鏈</ul><ul>驗證本人身份</ul><ul>已驗驗證非證書</ul>")}, 4500);
                                setInterval(  function(){ $("#name").html("驗證失敗")}, 3000 );
                            }
                        })
                        .catch(function(err) {
                            setInterval(  function(){ $("#content").html("<ul>無法連接區塊鏈</ul>") }, 3000);
                        });
                }else{
                    setInterval(  function(){ $("#content").html("<ul>沒有正確參數</ul>") }, 2000);
                }
            }
            else {
                setInterval(  function(){ $("#content").html("<ul>沒有參數</ul>")} , 2000 );
            }
        });
        
        
    </script>
</head>
<body>
    <div class="ts-container">
        <div class="center">
            <div id="verify_window" class="ts-modal is-visible">
                <div class="content">
                    <div class="ts-content is-dense">
                        <div class="ts-row">
                            <div class="column is-fluid">
                                <div class="ts-header">驗證程序</div>
                            </div>
                        </div>
                    </div>
                    <div class="ts-divider"></div>
                    <div class="ts-content" id="content">
                        <ul><div id="block_start" class='ts-loading'></div><i id="block_start_i"  class='fa fa-2x fa-solid fa-check' aria-hidden='true' style="display:none;"></i> &ensp; 連接區塊鏈</ul>
                        <ul id="second_ul" style="display:none;"><div id="block_mid" class='ts-loading'></div><i  id="block_mid_i" class='fa fa-2x fa-solid fa-check' aria-hidden='true' style="display:none"></i> &ensp; 驗證本人身份</ul>
                        <ul id="third_ul" style="display:none;"><div id="block_end" class='ts-loading'></div><i id="block_end_i" class='fa fa-2x fa-solid fa-check' aria-hidden='true' style="display:none"></i> &ensp; 已驗驗證證書</ul>
                    </div>
                    <div class="ts-divider"></div>
                    <div class="ts-content is-tertiary">
                        <div class="ts-wrap is-end-aligned">
                            <button class="ts-button is-fluid" id="close" onclick="close_window()">確定</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="data_windows" class="ts-modal is-big">
                <div class="content">
                    <div class="ts-content is-dense">
                        <div class="ts-row">
                            <div class="column is-fluid">
                                <div class="ts-header">證書資料</div>
                            </div>
                        </div>
                    </div>
                    <div class="ts-divider"></div>
                    <div class="ts-content" id="content">
                        <div class="ts-box">
                            <table class="ts-table is-striped">
                                <thead>
                                    <tr>
                                        <th>證書名稱</th>
                                        <th>發證單位</th>
                                        <th>發證日期</th>
                                        <th>證書編碼</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>皮膚科學會會員證書</td>
                                        <td>皮膚科學會</td>
                                        <td>2022/05/08</td>
                                        <td id="block"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                    </div>
                    <div class="ts-divider"></div>
                    <div class="ts-content is-tertiary">
                        <div class="ts-wrap is-end-aligned">
                            <button class="ts-button is-fluid" id="close" onclick="close_window()">確定</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ts-center" id="licence">
                
                    <!--<div class="ts-box is-warning is-top-indicated is-bottom-indicated is-left-indicated is-right-indicated">
                        <div id="start" class="ts-content is-tertiary is-vertically-very-padded is-start-aligned"></div>
                        <div id="name" class="verify_style ts-content is-tertiary is-vertically-very-padded is-center-aligned"></div>
                        <div id="end" class="ts-content is-tertiary is-vertically-very-padded is-end-aligned"></div>
                    </div>-->
                <div id="name" class="verify_style ts-content is-vertically-very-padded is-center-aligned"></div>
                <div id="under_data">
                    <div class="ts-row">
                        <div class="column">
                            <button id ="licence_button" class="ts-button is-outlined" onclick="windows_function()">證書資料</button>    
                        </div>
                        <div class="column">
                            <div id="qrcode"></div> 
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>    
        
    </div>
</body>
</html>